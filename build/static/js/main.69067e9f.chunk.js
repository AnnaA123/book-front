(this["webpackJsonpbook-site-front"]=this["webpackJsonpbook-site-front"]||[]).push([[0],{29:function(e,t,n){},30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var s=n(1),i=n.n(s),a=n(22),r=n.n(a),c=(n(29),n(8)),o=n(4),l=n(5),d=n(7),h=n(6),j=n(3),u=n(9),b=(n(30),n(0));var v=Object(u.f)((function(){return null!==localStorage.getItem("token")?Object(b.jsx)("nav",{className:"navbar navbar-expand navbar-dark bg-danger",children:Object(b.jsxs)("div",{className:"container-fluid",children:[Object(b.jsx)("a",{className:"navbar-brand",href:"/",children:"BookSight"}),Object(b.jsx)("div",{children:Object(b.jsxs)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:[Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",to:"/",children:"Search"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",onClick:function(){window.location.href="/user/".concat(localStorage.getItem("currentUser"))},children:"Profile"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",to:"/settings",children:"Settings"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",to:"/login",onClick:function(){localStorage.clear()},children:"Logout"})})]})})]})}):Object(b.jsx)("nav",{className:"navbar navbar-expand navbar-dark bg-danger",children:Object(b.jsxs)("div",{className:"container-fluid",children:[Object(b.jsx)(j.b,{className:"navbar-brand",to:"/",children:"BookSight"}),Object(b.jsx)("div",{children:Object(b.jsxs)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:[Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",to:"/",children:"Search"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.b,{className:"nav-link",to:"/login",children:"Login"})})]})})]})})})),m=n(2),f="https://www.googleapis.com/books",O=function(e){return fetch(f+"/v1/volumes/"+e).then((function(e){return e.json()}))},g=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getBooks=function(){var e;(e=s.state.searchTitle,fetch(f+"/v1/volumes?q=search+"+e).then((function(e){return e.json()}))).then((function(e){s.setState({books:e.items,loading:!1})}))},s.showThumbnail=function(e){return void 0!==e.volumeInfo.imageLinks?Object(b.jsx)("img",{className:"mt-3",src:e.volumeInfo.imageLinks.thumbnail,alt:e.volumeInfo.title}):Object(b.jsx)("p",{className:"mt-3",children:"(No image available)"})},s.componentDidMount=function(){s.getBooks()},s.state={books:[],searchTitle:e.sTitle,loading:!0},s.getBooks=s.getBooks.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0!==this.state.books?Object(b.jsx)("div",{className:"row row-cols-3",children:this.state.books.map((function(t){return Object(b.jsx)("div",{className:"col col-sm-4 border border-white",children:Object(b.jsx)(j.b,{className:"link-danger text-decoration-none",to:"/book/".concat(t.id),children:Object(b.jsxs)("div",{children:[e.showThumbnail(t),Object(b.jsx)("p",{children:t.volumeInfo.title})]})},t.id)},t.id)}))}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"No search results"})})}}]),n}(i.a.Component),x=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).toggler=function(){s.setState((function(e){return{toggle:!e.toggle}}))},s.searchResults=function(){if(s.state.toggle)return Object(b.jsx)("div",{children:Object(b.jsx)(g,{sTitle:s.state.searchTitle})})},s.handleTitleSearch=function(e){e.preventDefault(),console.log("searching "+s.state.searchTitle),s.setState((function(e){return{byAuthor:!1}})),s.toggler()},s.handleChange=function(e){e.preventDefault();var t=e.target.value;s.setState((function(){return{toggle:!1,searchTitle:t}}))},s.state={searchTitle:"",byAuthor:!1,toggle:!1},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.handleTitleSearch=s.handleTitleSearch.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)("div",{className:"d-inline-flex",children:Object(b.jsx)("form",{onSubmit:this.handleTitleSearch,children:Object(b.jsxs)("div",{className:"row g-3 align-items-center mt-1",children:[Object(b.jsx)("div",{className:"col-auto",children:Object(b.jsx)("label",{for:"searchTitle",className:"col-form-label",children:"Search for books by title"})}),Object(b.jsx)("div",{className:"col-auto",children:Object(b.jsx)("input",{className:"form-control",type:"search",placeholder:"Search",name:"searchTitle",value:this.state.searchTitle,onChange:this.handleChange})}),Object(b.jsx)("div",{className:"col-auto",children:Object(b.jsx)("button",{className:"btn btn-outline-danger",type:"submit",children:"Search"})})]})})}),Object(b.jsx)("div",{className:"mt-3",children:this.searchResults()})]})}}]),n}(i.a.Component);var p=function(e){return Object(b.jsx)("div",{children:Object(b.jsx)("div",{children:Object(b.jsx)(x,{})})})},w=n(13),k=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).doLogin=function(){(function(e,t){var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return fetch("http://localhost:8000/login",n).then((function(e){return e.json()}))})(s.state.user.username,s.state.user.password).then((function(e){if(void 0!==e.user){var t=s.props.setUser(e.user);return localStorage.setItem("token",e.token),localStorage.setItem("currentUser",e.user._id),s.props.history.push("/"),t}s.setState({errorMessage:"Username or password is incorrect."})}))},s.state={user:{username:"",password:""},errorMessage:"",validUser:!0},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(m.a)(s)),s.doLogin=s.doLogin.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleChange",value:function(e){var t=e.target,n=t.value,s=t.name;this.setState((function(e){return{user:Object(c.a)(Object(c.a)({},e.user),{},Object(w.a)({},s,n))}}))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.doLogin()}},{key:"render",value:function(){return Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"d-inline-flex",children:Object(b.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(b.jsx)("h1",{children:"Login"}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"username",className:"form-label",children:"Username"}),Object(b.jsx)("input",{type:"text",className:"form-control height=200px",name:"username",id:"username",label:"Username",value:this.state.user.username,onChange:this.handleChange})]}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"password",children:"Password"}),Object(b.jsx)("input",{type:"password",className:"form-control",name:"password",id:"password",label:"Password",value:this.state.user.password,onChange:this.handleChange})]}),Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:this.state.errorMessage})}),Object(b.jsxs)("div",{children:[Object(b.jsxs)("p",{children:["Don't have an account yet? ",Object(b.jsx)(j.b,{to:"/signup",children:"Sign up here!"})]}),Object(b.jsx)("p",{children:"\n"})]}),Object(b.jsx)("button",{type:"submit",className:"btn btn-danger",children:"Login"})]})})})}}]),n}(i.a.Component),N=Object(u.f)(k);var S=function(e){return Object(b.jsx)("div",{children:Object(b.jsx)(N,{setUser:e.setUser})})},C="http://localhost:8000/user",y=function(e){return fetch(C+"/"+e).then((function(e){return e.json()})).catch((function(e){return console.error("Error:",e)}))},I=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleSubmit=function(e){(e.preventDefault(),s.state.user.password===s.state.user.checkPw)?function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return fetch(C,t).then((function(e){return e.json()}))}({username:s.state.user.username,email:s.state.user.email,password:s.state.user.password,description:"Welcome to my profile!"}).then((function(e){void 0!==e.error?s.setState({errorMessage:"Cannot signup. Username, password or email needs to be changed."}):s.setState({userCreated:!0})})):s.setState({errorMessage:"Passwords do not match."})},s.state={user:{username:"",email:"",password:"",checkPw:""},errorMessage:"",userCreated:!1},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleChange",value:function(e){var t=e.target,n=t.value,s=t.name;this.setState((function(e){return{user:Object(c.a)(Object(c.a)({},e.user),{},Object(w.a)({},s,n))}}))}},{key:"render",value:function(){return this.state.userCreated?Object(b.jsxs)("div",{children:[Object(b.jsx)("p",{children:"User has been successfully created."}),Object(b.jsx)(j.b,{to:"/login",children:"Back to Login page"})]}):Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:" d-inline-flex",children:Object(b.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(b.jsx)("h1",{children:"Sign Up"}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"username",children:"Username"}),Object(b.jsx)("input",{type:"text",className:"form-control",name:"username",value:this.state.username,onChange:this.handleChange})]}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"email",children:"Email Address"}),Object(b.jsx)("input",{type:"email",className:"form-control",name:"email",value:this.state.email,onChange:this.handleChange})]}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"password",children:"Password"}),Object(b.jsx)("input",{type:"password",className:"form-control",name:"password",value:this.state.password,onChange:this.handleChange})]}),Object(b.jsxs)("div",{for:"checkPw",className:"mb-3",children:[Object(b.jsx)("label",{children:"Password again"}),Object(b.jsx)("input",{type:"password",className:"form-control",name:"checkPw",value:this.state.checkPw,onChange:this.handleChange})]}),Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:this.state.errorMessage})}),Object(b.jsx)("div",{children:Object(b.jsxs)("p",{children:["Already have an account? ",Object(b.jsx)(j.b,{to:"/login",children:"Login here!"})]})}),Object(b.jsx)("button",{type:"submit",className:"btn btn-danger",children:"Sign Up"})]})})})}}]),n}(i.a.Component),U=Object(u.f)(I);var D=function(e){return Object(b.jsx)("div",{children:Object(b.jsx)(U,{})})},B=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getUserId=function(){var e=window.location.href.split("/"),t=e[e.length-1];return console.log("USERID "+t),t},s.getUser=function(e){y(e).then((function(e){s.setState({user:e,edits:e.description,loading:!1}),e._id===localStorage.getItem("currentUser")&&s.setState({userProfile:!0})}))},s.editDescription=function(e){e.preventDefault(),function(e,t,n){var s={method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",authorization:"bearer "+n},body:JSON.stringify(e)};return fetch(C+"/"+t,s).then((function(e){return e.json()}))}({description:s.state.edits},localStorage.getItem("currentUser"),localStorage.getItem("token")).then((function(e){void 0!==e.error?console.log(e.error):(console.log("success"),window.location.reload())}))},s.userDescription=function(){return s.state.editing?Object(b.jsx)("div",{className:"d-flex flex-column",children:Object(b.jsxs)("form",{id:"descform",onSubmit:s.editDescription,children:[Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsx)("textarea",{form:"descform",className:"form-control",name:"edits",value:s.state.edits,onChange:s.handleChange})}),Object(b.jsx)("button",{className:"btn btn-danger m-3",type:"submit",children:"Save"})]})}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:s.state.user.description})})},s.handleEditBtn=function(e){e.preventDefault(),s.setState({editing:!s.state.editing})},s.editBtn=function(){if(s.state.userProfile&&!1===s.state.editing)return Object(b.jsx)("div",{children:Object(b.jsx)("button",{className:"btn btn-danger m-3",onClick:s.handleEditBtn,children:"Edit profile"})})},s.state={user:[],edits:"",editing:!1,userProfile:!1,loading:!0},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.handleEditBtn=s.handleEditBtn.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleChange",value:function(e){var t=e.target.value,n=e.target.name;this.setState((function(e){return Object(w.a)({},n,t)}))}},{key:"componentDidMount",value:function(){var e=this.getUserId();this.getUser(e)}},{key:"render",value:function(){return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0!==this.state.user?Object(b.jsxs)("div",{className:"p-5 w-100",children:[Object(b.jsx)("h2",{children:this.state.user.username}),this.userDescription(),this.editBtn()]}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"This user does not exist"})})}}]),n}(i.a.Component),T=Object(u.f)(B),E="http://localhost:8000/review",L=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getUserId=function(){var e=window.location.href.split("/"),t=e[e.length-1];return console.log("USERID "+t),t},s.getReviews=function(e){var t;(t=e,fetch(E+"?user="+t).then((function(e){return e.json()}))).then((function(e){s.setState({reviews:e,loading:!1})}))},s.state={reviews:[],loading:!0},s.getReviews=s.getReviews.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this.getUserId();this.getReviews(e)}},{key:"render",value:function(){return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0!==this.state.reviews[0]?Object(b.jsxs)("div",{className:"p-2 w-100",children:[Object(b.jsx)("h4",{className:"mt-3",children:"Reviews by this user:"}),this.state.reviews.map((function(e){return Object(b.jsx)("div",{className:"mb-3 border-top border-dark",children:Object(b.jsx)(j.b,{className:"link-danger text-decoration-none",to:"/review/".concat(e._id),children:Object(b.jsxs)("div",{children:[Object(b.jsx)("h5",{className:"mt-2",children:e.Title}),Object(b.jsx)("p",{className:"small",children:e.BookTitle})]})})},e._id)}))," "]}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"No reviews"})})}}]),n}(i.a.Component);var R=function(e){return Object(b.jsxs)("div",{className:"d-flex flex-row",children:[Object(b.jsx)(T,{}),Object(b.jsx)(L,{})]})},P=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getBookId=function(){var e=window.location.href.split("/");return e[e.length-1]},s.getBookInfo=function(e){O(e).then((function(e){void 0!==e?s.setState({bookInfo:e,loading:!1}):console.log("Error retrieving data.")}))},s.showBookAuthors=function(e){if(void 0!==e.volumeInfo.authors)return Object(b.jsx)("div",{children:e.volumeInfo.authors.map((function(e){return Object(b.jsx)("p",{children:e})}))})},s.showCover=function(e){return void 0!==e.volumeInfo.imageLinks?Object(b.jsx)("img",{className:"mt-3",src:e.volumeInfo.imageLinks.thumbnail,alt:e.volumeInfo.title}):Object(b.jsx)("p",{className:"mt-3 mb-3",children:"No image available"})},s.componentDidMount=function(){var e=s.getBookId();s.getBookInfo(e)},s.componentWillUnmount=function(){s.setState=function(e,t){}},s.state={bookInfo:[],loading:!0,authorKey:0},s.handleClick=s.handleClick.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleClick",value:function(e){e.preventDefault(),this.props.history.push("/write")}},{key:"render",value:function(){return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0===this.state.bookInfo.volumeInfo?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"error"})}):Object(b.jsx)("div",{className:"p-2 m-3",children:Object(b.jsxs)("div",{children:[this.showCover(this.state.bookInfo),Object(b.jsx)("h3",{children:this.state.bookInfo.volumeInfo.title}),this.showBookAuthors(this.state.bookInfo),Object(b.jsx)(j.b,{className:"link-danger text-decoration-none",to:"/write/".concat(this.state.bookInfo.id),children:"Write review"})]})})}}]),n}(i.a.Component),M=Object(u.f)(P),A=n(24),J=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getBookId=function(){var e=window.location.href.split("/"),t=e[e.length-1];return console.log("review BOOKID "+t),t},s.getUser=function(e){void 0!==s.state.reviews[0]?y(e).then((function(e){s.setState((function(t){return{users:[].concat(Object(A.a)(t.users),[e])}}))})):(console.log("oops"),setTimeout(s.getUser(e),1e3))},s.findUser=function(e){var t=s.state.users.findIndex((function(t){return t._id===e})),n=s.state.users[t];return void 0===n?"":n.username},s.state={reviews:[],users:[],loading:!0},s.getReviews=s.getReviews.bind(Object(m.a)(s)),s.handleClick=s.handleClick.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"getReviews",value:function(e){var t,n=this;(t=e,fetch(E+"?book="+t).then((function(e){return e.json()}))).then((function(e){n.setState({reviews:e,loading:!1}),e.map((function(e){return n.getUser(e.UserID)}))}))}},{key:"handleClick",value:function(e){e.preventDefault(),console.log("!!!!!!!!!!!!!!!!! "+JSON.stringify(this.state.users))}},{key:"componentDidMount",value:function(){var e=this.getBookId();this.getReviews(e)}},{key:"render",value:function(){var e=this;return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0!==this.state.reviews[0]?Object(b.jsx)("div",{className:"p-5 w-100 flex-column",children:this.state.reviews.map((function(t){return Object(b.jsx)("div",{className:"mb-3 border-bottom border-dark",children:Object(b.jsxs)("div",{className:"mb-3 ",children:[Object(b.jsx)(j.b,{className:"link-danger text-decoration-none",to:"/review/".concat(t._id),children:Object(b.jsx)("h3",{children:t.Title})}),Object(b.jsx)("p",{children:t.Content}),Object(b.jsx)(j.b,{className:"link-dark fw-bold",to:"/user/".concat(t.UserID),children:e.findUser(t.UserID)})]})},t._id)}))}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"No reviews"})})}}]),n}(i.a.Component);var _=function(e){return console.log("BOOKJSprops: "+JSON.stringify(e)),Object(b.jsxs)("div",{className:"d-flex flex-row",children:[Object(b.jsx)(M,Object(c.a)({},e)),Object(b.jsx)(J,Object(c.a)({},e))]})},W=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getBookId=function(){var e=window.location.href.split("/");return e[e.length-1]},s.getBookInfo=function(e){O(e).then((function(e){void 0!==e?s.setState({book:e}):console.log("Error retrieving book.")}))},s.handleSubmit=function(e){e.preventDefault(),function(e,t){var n={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",authorization:"bearer "+t},body:JSON.stringify(e)};return fetch(E,n).then((function(e){return e.json()}))}({BookID:s.state.book.id,UserID:localStorage.getItem("currentUser"),BookTitle:s.state.book.volumeInfo.title,Title:s.state.review.title,Content:s.state.review.content},localStorage.getItem("token")).then((function(e){void 0!==e.error?console.log("ERROR "+e.error):s.props.history.push("/book/".concat(s.state.book.id))}))},s.componentDidMount=function(){var e=s.getBookId();s.getBookInfo(e)},s.state={book:[],review:{title:"",content:""},errorMessage:""},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleChange",value:function(e){var t=e.target,n=t.value,s=t.name;this.setState((function(e){return{review:Object(c.a)(Object(c.a)({},e.review),{},Object(w.a)({},s,n))}}))}},{key:"render",value:function(){return Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("div",{className:"d-inline-flex",children:Object(b.jsxs)("form",{id:"writeform",onSubmit:this.handleSubmit,children:[Object(b.jsx)("h2",{children:"Write review"}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"reviewtitle",className:"form-label",children:"Title"}),Object(b.jsx)("input",{id:"reviewtitle",type:"text",className:"form-control",name:"title",label:"Title",value:this.state.review.title,onChange:this.handleChange})]}),Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"contenttext",className:"form-label",children:"Your review"}),Object(b.jsx)("textarea",{id:"contenttext",form:"writeform",className:"form-control",name:"content",value:this.state.review.content,onChange:this.handleChange})]}),Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:this.state.errorMessage})}),Object(b.jsx)("button",{className:"btn btn-danger m-3",type:"submit",children:"Submit review"})]})})})}}]),n}(i.a.Component),z=Object(u.f)(W);var F=function(e){return Object(b.jsx)("div",{children:Object(b.jsx)(z,{})})},K=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).getReviewId=function(){var e=window.location.href.split("/");return e[e.length-1]},s.getUser=function(e){void 0!==s.state.review?y(e).then((function(e){s.setState((function(t){return{user:e}}))})):setTimeout(s.getUser(e),1e3)},s.findUser=function(e){var t=s.state.user.findIndex((function(t){return t._id===e})),n=s.state.user[t];return void 0===n?"":n.username},s.getBookData=function(e){O(e).then((function(e){void 0!==e?s.setState({book:e}):console.log("Error retrieving book.")}))},s.reviewEdit=function(e){e.preventDefault(),function(e,t,n){var s={method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",authorization:"bearer "+n},body:JSON.stringify(e)};return fetch(E+"/"+t,s).then((function(e){return e.json()}))}({Content:s.state.edits},s.state.review._id,localStorage.getItem("token")).then((function(e){void 0!==e.error?console.log(e.error):window.location.reload()}))},s.handleEditBtn=function(e){e.preventDefault(),s.setState({editing:!s.state.editing})},s.handleDelete=function(e){var t,n;e.preventDefault(),(t=s.state.review._id,n=localStorage.getItem("token"),console.log("YES "+t+n),fetch(E+"/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",authorization:"bearer "+n}}).then((function(e){return e.json()}))).then((function(e){void 0!==e.error?console.log(e.error):(console.log("deleted "+JSON.stringify(s.props)),s.props.history.push("/user/".concat(localStorage.getItem("currentUser"))))}))},s.contentView=function(){return s.state.editing?Object(b.jsx)("div",{className:"d-flex flex-column",children:Object(b.jsxs)("form",{id:"editform",onSubmit:s.reviewEdit,children:[Object(b.jsx)("div",{className:"input-group mb-3",children:Object(b.jsx)("textarea",{form:"editform",className:"form-control",name:"edits",value:s.state.edits,onChange:s.handleChange})}),Object(b.jsx)("button",{className:"btn btn-danger m-3",type:"submit",children:"Save"})]})}):Object(b.jsxs)("div",{children:[Object(b.jsx)("p",{children:s.state.review.Content}),Object(b.jsx)(j.b,{className:"link-dark fw-bold",to:"/user/".concat(s.state.user._id),children:s.state.user.username})]})},s.editBtn=function(){if(s.state.viewerWriter&&!1===s.state.editing)return Object(b.jsx)("div",{children:Object(b.jsx)("button",{className:"btn btn-danger m-3",onClick:s.handleEditBtn,children:"Edit review"})})},s.deleteBtn=function(){if(s.state.viewerWriter)return Object(b.jsx)("div",{children:Object(b.jsx)("button",{className:"btn btn-danger mt-5 m-3",onClick:s.handleDelete,children:"Delete review"})})},s.showCover=function(e){return void 0!==e.volumeInfo.imageLinks?Object(b.jsx)("img",{className:"mt-3",src:e.volumeInfo.imageLinks.thumbnail,alt:e.volumeInfo.title}):Object(b.jsx)("p",{className:"mt-3 mb-3",children:"No image available"})},s.showBookAuthors=function(e){if(void 0!==e.volumeInfo.authors)return Object(b.jsx)("div",{children:e.volumeInfo.authors.map((function(e){return Object(b.jsx)("p",{children:e})}))})},s.state={review:[],edits:"",user:[],book:[],viewerWriter:!1,editing:!1,loading:!0},s.handleChange=s.handleChange.bind(Object(m.a)(s)),s.getReview=s.getReview.bind(Object(m.a)(s)),s.reviewEdit=s.reviewEdit.bind(Object(m.a)(s)),s.handleEditBtn=s.handleEditBtn.bind(Object(m.a)(s)),s.handleDelete=s.handleDelete.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"handleChange",value:function(e){var t=e.target.value,n=e.target.name;this.setState((function(e){return Object(w.a)({},n,t)}))}},{key:"getReview",value:function(e){var t,n=this;(t=e,fetch(E+"/"+t).then((function(e){return e.json()}))).then((function(e){n.setState({review:e,loading:!1,edits:e.Content}),console.log(e),n.getUser(e.UserID),n.getBookData(e.BookID),localStorage.getItem("currentUser")===e.UserID&&n.setState({viewerWriter:!0})}))}},{key:"componentDidMount",value:function(){var e=this.getReviewId();this.getReview(e)}},{key:"render",value:function(){return this.state.loading?Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})}):void 0!==this.state.review.Title&&void 0!==this.state.book.volumeInfo?Object(b.jsxs)("div",{className:"d-flex flex-row",children:[Object(b.jsx)("div",{children:Object(b.jsxs)("div",{className:"p-2 m-3",children:[this.showCover(this.state.book),Object(b.jsx)(j.b,{className:"link-danger text-decoration-none",to:"/book/".concat(this.state.book.id),children:Object(b.jsx)("h2",{children:this.state.book.volumeInfo.title})}),this.showBookAuthors(this.state.book),this.deleteBtn()]})}),Object(b.jsxs)("div",{className:"p-5 w-100",children:[Object(b.jsx)("h3",{children:this.state.review.Title}),this.contentView(),this.editBtn()]})]}):Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"Loading..."})})}}]),n}(i.a.Component),V=Object(u.f)(K);var Y=function(e){return Object(b.jsx)("div",{children:Object(b.jsx)(V,{})})},q=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).removeUser=function(e){(function(e,t){return fetch(C+"/"+e,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json",authorization:"bearer "+t}}).then((function(e){return e.json()}))})(e,localStorage.getItem("token")).then((function(e){void 0!==e.error?console.log("what "+e.error):(console.log("successful deletion"),localStorage.clear(),s.props.history.push("/login"))}))},s.handleClick=function(e){e.preventDefault(),s.removeUser(localStorage.getItem("currentUser"))},s.handleClick=s.handleClick.bind(Object(m.a)(s)),s}return Object(l.a)(n,[{key:"render",value:function(){return Object(b.jsx)("div",{children:Object(b.jsx)("button",{className:"btn btn-danger m-3",onClick:this.handleClick,children:"Delete user"})})}}]),n}(i.a.Component),G=Object(u.f)(q);var H=function(e){return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Settings"}),Object(b.jsx)(G,{})]})},Q=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).setUser=function(e){s.setState({user:e})},s.state={user:null},s}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)("div",{className:"container",children:Object(b.jsxs)(j.a,{basename:"",children:[Object(b.jsx)(v,{}),Object(b.jsxs)(u.c,{children:[Object(b.jsx)(u.a,{exact:!0,path:"/",render:function(e){return Object(b.jsx)(p,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/login",render:function(t){return Object(b.jsx)(S,Object(c.a)(Object(c.a)({},t),{},{state:e.state,setUser:e.setUser}))}}),Object(b.jsx)(u.a,{exact:!0,path:"/signup",render:function(e){return Object(b.jsx)(D,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/user/:id",render:function(e){return Object(b.jsx)(R,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/book/:id",render:function(e){return Object(b.jsx)(_,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/write/:id",render:function(e){return Object(b.jsx)(F,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/review/:id",render:function(e){return Object(b.jsx)(Y,Object(c.a)({},e))}}),Object(b.jsx)(u.a,{exact:!0,path:"/settings",render:function(e){return Object(b.jsx)(H,Object(c.a)({},e))}})]})]})})})}}]),n}(i.a.Component),X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),s(e),i(e),a(e),r(e)}))};r.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(Q,{})}),document.getElementById("root")),X()}},[[37,1,2]]]);
//# sourceMappingURL=main.69067e9f.chunk.js.map